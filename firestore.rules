rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Security rules for notes collection
    match /notes/{noteId} {
      // Allow anyone to read any note
      allow read: if true;

      // Allow anyone to create a note
      allow create: if request.resource.data.keys().hasAll(['id', 'content', 'createdAt', 'updatedAt'])
                    && request.resource.data.id == noteId
                    && request.resource.data.content is string
                    && request.resource.data.content.size() <= 1000000; // Max 1MB

      // Allow anyone to update a note's content
      allow update: if request.resource.data.keys().hasAll(['id', 'content', 'createdAt', 'updatedAt'])
                    && request.resource.data.id == resource.data.id
                    && request.resource.data.content is string
                    && request.resource.data.content.size() <= 1000000
                    && request.resource.data.createdAt == resource.data.createdAt;

      // Don't allow deletes
      allow delete: if false;
    }
  }
}
